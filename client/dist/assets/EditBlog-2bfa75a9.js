import{f as A,u as I,b as R,r as n,j as t,h as L,B as y,d as c}from"./index-0685d0f1.js";import{I as $}from"./Input-41c5edce.js";const z=()=>{const{_id:r}=A(),{currentUser:x}=I(),p=R(),[g,w]=n.useState(""),[u,k]=n.useState(""),[j,v]=n.useState(""),[h,a]=n.useState(""),[T,N]=n.useState(""),[E,b]=n.useState(!1),[P,m]=n.useState(!0);n.useEffect(()=>{(async()=>{if(!r){a("No blog ID provided"),m(!1);return}try{console.log("Fetching blog with ID:",r);let o;try{o=await c.get(`/api/blogs/${r}/`)}catch(e){if(e.response&&e.response.status===404)o=await c.get(`/api/blogs/${r}`);else throw e}const i=o.data;console.log("Blog data:",i),w(i.title||""),k(i.content||""),v(i.image_url||""),m(!1)}catch(o){console.error("Error fetching blog:",o),a("Failed to fetch blog. Please try again."),m(!1)}})()},[r]);const q=async s=>{var o,i;if(s.preventDefault(),a(""),N(""),!g.trim()||!u.trim())return a("Title and content are required");b(!0);try{if(!x){a("You must be logged in to edit a blog post"),b(!1);return}const e=await x.getIdToken(),l={title:g,content:u,image_url:j};let d;try{console.log("Trying direct PUT request without trailing slash"),d=await c.put(`/api/blogs/${r}`,l,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}catch(B){console.error("PUT request without trailing slash failed:",B);try{console.log("Trying PUT request with trailing slash"),d=await c.put(`/api/blogs/${r}/`,l,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}catch(U){console.error("PUT request with trailing slash failed:",U);try{console.log("Trying PATCH request"),d=await c.patch(`/api/blogs/${r}`,l,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}catch(C){console.error("PATCH request failed:",C);try{console.log("Trying final fallback with axios request"),d=await c({method:"post",url:`/api/blogs/${r}/`,data:{...l,_method:"PUT"},headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","X-HTTP-Method-Override":"PUT"}})}catch(S){console.error("POST with method override failed:",S),console.log("Trying direct fetch request as last resort");const f=await fetch(`/api/blogs/${r}/`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(!f.ok)throw new Error(`Fetch request failed with status ${f.status}`);d={data:await f.json()}}}}}console.log("Update successful:",d.data),N("Blog updated successfully! Redirecting..."),setTimeout(()=>{p(`/blog/${r}`)},1500)}catch(e){if(console.error("Error updating blog:",e),e.response)if(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data),e.response.status===403)a("Permission denied. You do not have permission to edit this blog.");else if(e.response.status===404)a("Blog not found. It may have been deleted.");else if(e.response.status===500)a("Server error. Please try again later or contact support.");else if(e.response.status===400){const l=((o=e.response.data)==null?void 0:o.detail)||JSON.stringify(e.response.data);a(`Validation error: ${l}`)}else a(`Error (${e.response.status}): ${((i=e.response.data)==null?void 0:i.detail)||e.response.statusText||"Failed to update blog"}`);else e.request?(console.error("Request made but no response received:",e.request),a("No response from server. Please check your connection and try again.")):(console.error("Error setting up request:",e.message),a(`Error: ${e.message}`));b(!1)}};return P?t.jsx(L,{}):h&&!g&&!u?t.jsx("div",{className:"min-h-screen flex justify-center items-center bg-white dark:bg-black px-4",children:t.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-black p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-700",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Error"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:h}),t.jsx(y,{variant:"primary",onClick:()=>p("/"),children:"Back to Home"})]})}):t.jsx("div",{className:"min-h-screen bg-white dark:bg-black transition-colors duration-200 page-content",children:t.jsx("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:t.jsx("div",{className:"bg-white dark:bg-black rounded-lg shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden",children:t.jsxs("div",{className:"p-4 md:p-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white font-playfair mb-4",children:"Edit Blog Post"}),h&&t.jsx("div",{className:"bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-gray-300 p-3 rounded-md mb-6 text-sm border border-gray-200 dark:border-gray-700",children:h}),T&&t.jsx("div",{className:"bg-green-50 dark:bg-green-900 text-green-700 dark:text-green-300 p-3 rounded-md mb-6 text-sm border border-green-200 dark:border-green-700",children:T}),t.jsxs("form",{onSubmit:q,className:"space-y-6",children:[t.jsx($,{id:"title",label:"Title",value:g,onChange:s=>w(s.target.value),placeholder:"Enter a catchy title",required:!0}),t.jsx($,{id:"imageUrl",label:"Image URL (optional)",value:j,onChange:s=>v(s.target.value),placeholder:"Enter an image URL for your blog"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Content"}),t.jsx("textarea",{id:"content",value:u,onChange:s=>k(s.target.value),placeholder:"Write your blog content here...",rows:8,className:"appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blog-accent focus:border-blog-accent dark:bg-gray-700 dark:text-white transition-colors duration-200",required:!0})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(y,{type:"button",variant:"outline",onClick:()=>p(`/blog/${r}`),children:"Cancel"}),t.jsx(y,{type:"submit",variant:"primary",disabled:E,children:E?"Updating...":"Update Post"})]})]})]})})})})};export{z as default};
