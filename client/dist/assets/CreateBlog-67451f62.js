import{u as M,b as W,r as n,j as e,B as P,d as y}from"./index-0685d0f1.js";import{I as $}from"./Input-41c5edce.js";const J=()=>{const{currentUser:w}=M(),h=W(),[g,k]=n.useState(""),[m,v]=n.useState(""),[i,b]=n.useState(""),[j,N]=n.useState(null),[x,I]=n.useState(!1),[p,S]=n.useState(0),[C,s]=n.useState(""),[B,f]=n.useState(!1),[D,A]=n.useState("");n.useEffect(()=>{try{const r=localStorage.getItem("pendingBlogData");if(r){const t=JSON.parse(r),a=new Date(t.timestamp),c=new Date,d=new Date(c.getTime()-60*60*1e3);a>d&&window.confirm("We found a draft of a blog post you were creating. Would you like to restore it?")?(k(t.title||""),v(t.content||""),b(t.imageUrl||""),A("Your draft has been restored. Continue editing and submit when ready.")):localStorage.removeItem("pendingBlogData")}}catch(r){console.error("Error checking for pending blog data:",r),localStorage.removeItem("pendingBlogData")}},[]);const L=r=>{const t=r.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){s("Please select an image file");return}if(t.size>5*1024*1024){s("Image size should be less than 5MB");return}N(t),s("");const a=URL.createObjectURL(t);b(a),I(!0)},O=async(r,t)=>{if(!r)return null;try{const a=new FormData;return a.append("image",r),(await y.post("/api/upload/",a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${t}`},onUploadProgress:d=>{const o=Math.round(d.loaded*100/d.total);S(o)}})).data.url}catch(a){throw console.error("Error uploading image:",a),new Error("Failed to upload image. "+a.message)}},z=async r=>{var t,a,c,d;if(r.preventDefault(),s(""),!g.trim()||!m.trim())return s("Title and content are required");if(!w)return s("You must be logged in to create a blog post.");f(!0);try{const o={title:g,content:m,imageUrl:i,timestamp:new Date().toISOString()};localStorage.setItem("pendingBlogData",JSON.stringify(o));const E=await w.getIdToken(),U="/api/blogs/";console.log("Posting to:",U);let u=i;if(j)try{u=await O(j,E)}catch(l){if(!i)throw l;console.warn("Image upload failed, using provided URL instead:",l)}const T=new AbortController,F=setTimeout(()=>T.abort(),2e4);try{const l=await y.post(U,{title:g,content:m,image_url:(u==null?void 0:u.trim())||null},{headers:{Authorization:`Bearer ${E}`},signal:T.signal});clearTimeout(F);const R=l.data._id||l.data.id;if(!R)throw new Error("No blog ID returned from server");localStorage.removeItem("pendingBlogData"),s(""),f(!1),setTimeout(()=>{h(`/blog/${R}`)},500);return}catch(l){if(clearTimeout(F),l.name==="AbortError"||l.code==="ECONNABORTED"){console.log("Blog creation is taking longer than expected, but may still succeed in the background."),s("Blog creation is taking longer than expected. Your blog may still be created in the background. Please check your dashboard in a few moments."),setTimeout(()=>{h("/dashboard")},3e3);return}throw l}}catch(o){console.error("Failed to create blog:",o),y.isAxiosError(o)?s(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.detail)||((d=(c=o.response)==null?void 0:c.data)==null?void 0:d.message)||o.message||"Failed to create blog"):s(o.message)}finally{f(!1),S(0)}};return e.jsx("div",{className:"min-h-screen bg-white dark:bg-black transition-colors duration-200 page-content",children:e.jsx("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white dark:bg-black rounded-lg shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white font-playfair mb-4",children:"Create New Blog Post"}),C&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 p-3 rounded-md mb-6 text-sm border border-red-100 dark:border-red-800/30",children:C}),D&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 p-3 rounded-md mb-6 text-sm border border-green-100 dark:border-green-800/30",children:D}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsx($,{id:"title",label:"Title",value:g,onChange:r=>k(r.target.value),placeholder:"Enter a catchy title",required:!0}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"bannerImage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Banner Image (optional)"}),e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"dropzone-file",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-gray-700 dark:bg-gray-800 hover:bg-gray-100 dark:border-gray-600",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-8 h-8 mb-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG or GIF (MAX. 5MB)"})]}),e.jsx("input",{id:"dropzone-file",type:"file",className:"hidden",accept:"image/*",onChange:L})]})})}),p>0&&p<100&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mt-2",children:e.jsx("div",{className:"bg-blog-accent h-2.5 rounded-full dark:bg-blue-500",style:{width:`${p}%`}})}),e.jsxs("div",{className:"relative flex items-center py-2",children:[e.jsx("div",{className:"flex-grow border-t border-gray-300 dark:border-gray-700"}),e.jsx("span",{className:"flex-shrink mx-4 text-gray-400 dark:text-gray-500 text-sm",children:"OR"}),e.jsx("div",{className:"flex-grow border-t border-gray-300 dark:border-gray-700"})]}),e.jsx("label",{htmlFor:"imageUrl",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Image URL"}),e.jsx("div",{className:"mt-1 flex rounded-md shadow-sm",children:e.jsx("input",{type:"url",name:"imageUrl",id:"imageUrl",className:"appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blog-accent focus:border-blog-accent dark:bg-gray-700 dark:text-white transition-colors duration-200",placeholder:"https://example.com/image.jpg",value:i,onChange:r=>{b(r.target.value),N(null)}})}),i&&e.jsxs("div",{className:"mt-2",children:[e.jsx("button",{type:"button",onClick:()=>I(!x),className:"text-sm text-blog-accent hover:text-blog-accent/80 dark:text-blue-400 dark:hover:text-blue-300",children:x?"Hide preview":"Show preview"}),x&&e.jsx("div",{className:"mt-2 border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden",children:e.jsx("img",{src:i,alt:"Banner preview",className:"w-full h-48 object-cover",onError:r=>{r.target.onerror=null,r.target.src="https://via.placeholder.com/800x400?text=Invalid+Image+URL"}})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Content"}),e.jsx("textarea",{id:"content",value:m,onChange:r=>v(r.target.value),placeholder:"Write your blog content here...",rows:8,className:"appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blog-accent focus:border-blog-accent dark:bg-gray-700 dark:text-white transition-colors duration-200",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>h("/"),children:"Cancel"}),e.jsx(P,{type:"submit",variant:"primary",disabled:B,children:B?"Creating...":"Create Post"})]})]})]})})})})};export{J as default};
